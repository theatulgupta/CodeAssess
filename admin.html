<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Coding Assessment</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        min-height: 100vh;
        color: #333;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 20px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .header-content {
        max-width: 1400px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        color: #1e3c72;
      }

      .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .refresh-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .refresh-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
      }

      .auto-refresh {
        color: #6c757d;
        font-size: 14px;
      }

      .container {
        max-width: 1400px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border-left: 5px solid #1e3c72;
        transition: transform 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .stat-icon {
        font-size: 24px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }

      .stat-submissions {
        background: #17a2b8;
      }
      .stat-average {
        background: #28a745;
      }
      .stat-highest {
        background: #ffc107;
        color: #333 !important;
      }
      .stat-lowest {
        background: #dc3545;
      }

      .stat-number {
        font-size: 32px;
        font-weight: bold;
        color: #1e3c72;
      }

      .stat-label {
        color: #6c757d;
        font-size: 14px;
      }

      .results-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .section-header {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: white;
        padding: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .section-title {
        font-size: 24px;
        font-weight: 600;
      }

      .export-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.3s ease;
      }

      .export-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .filters {
        padding: 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }

      .filter-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .filter-select {
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 20px;
        background: white;
        font-size: 14px;
      }

      .results-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      .results-table th {
        background: #f8f9fa;
        padding: 15px 12px;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 2px solid #dee2e6;
        position: sticky;
        top: 0;
      }

      .results-table td {
        padding: 15px 12px;
        border-bottom: 1px solid #dee2e6;
        transition: background 0.3s ease;
      }

      .results-table tbody tr:hover {
        background: #f8f9fa;
      }

      .student-name {
        font-weight: 600;
        color: #1e3c72;
      }

      .student-roll {
        font-family: "Courier New", monospace;
        font-weight: 500;
        color: #2a5298;
        background: #f8f9fa;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 13px;
      }

      .score-badge {
        padding: 5px 12px;
        border-radius: 15px;
        font-weight: 600;
        color: white;
        font-size: 12px;
      }

      .score-excellent {
        background: #28a745;
      }
      .score-good {
        background: #17a2b8;
      }
      .score-average {
        background: #ffc107;
        color: #333;
      }
      .score-poor {
        background: #dc3545;
      }

      .question-score {
        text-align: center;
        font-weight: 600;
      }

      .score-full {
        color: #28a745;
      }
      .score-partial {
        color: #ffc107;
      }
      .score-zero {
        color: #dc3545;
      }

      .submission-time {
        color: #6c757d;
        font-size: 12px;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #6c757d;
      }

      .loading-spinner {
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #1e3c72;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .no-results-icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      .detailed-view-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 12px;
        transition: background 0.3s ease;
      }

      .detailed-view-btn:hover {
        background: #0056b3;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        backdrop-filter: blur(5px);
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 800px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f8f9fa;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6c757d;
      }

      .code-display {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 13px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }

      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 15px;
        }

        .dashboard-stats {
          grid-template-columns: 1fr;
        }

        .filters {
          flex-direction: column;
          align-items: stretch;
        }

        .results-table {
          font-size: 12px;
        }

        .results-table th,
        .results-table td {
          padding: 10px 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-content">
        <div class="logo">üìä Admin Dashboard</div>
        <div class="header-actions">
          <button class="refresh-btn" onclick="loadResults()">
            üîÑ Refresh Data
          </button>
          <div class="auto-refresh">
            Auto-refresh: <span id="countdown">10</span>s
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="dashboard-stats" id="dashboardStats">
        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="totalSubmissions">0</div>
              <div class="stat-label">Total Submissions</div>
            </div>
            <div class="stat-icon stat-submissions">üìù</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="averageScore">0%</div>
              <div class="stat-label">Average Score</div>
            </div>
            <div class="stat-icon stat-average">üìä</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="highestScore">0%</div>
              <div class="stat-label">Highest Score</div>
            </div>
            <div class="stat-icon stat-highest">üèÜ</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-number" id="lowestScore">0%</div>
              <div class="stat-label">Lowest Score</div>
            </div>
            <div class="stat-icon stat-lowest">üìâ</div>
          </div>
        </div>
      </div>

      <div class="results-section">
        <div class="section-header">
          <div class="section-title">Live Results</div>
          <button class="export-btn" onclick="exportResults()">
            üì• Export CSV
          </button>
        </div>

        <div class="filters">
          <div class="filter-group">
            <label>Sort by:</label>
            <select class="filter-select" id="sortBy" onchange="sortResults()">
              <option value="score-desc">Score (High to Low)</option>
              <option value="score-asc">Score (Low to High)</option>
              <option value="name-asc">Name (A-Z)</option>
              <option value="time-desc">Submission Time (Latest)</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Show:</label>
            <select
              class="filter-select"
              id="filterBy"
              onchange="filterResults()"
            >
              <option value="all">All Submissions</option>
              <option value="excellent">Excellent (90%+)</option>
              <option value="good">Good (75-89%)</option>
              <option value="average">Average (60-74%)</option>
              <option value="poor">Poor (<60%)</option>
            </select>
          </div>
        </div>

        <div id="resultsContainer">
          <div class="loading">
            <div class="loading-spinner"></div>
            <div>Loading results...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed View Modal -->
    <div class="modal" id="detailModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Student Details</h3>
          <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div id="modalContent"></div>
      </div>
    </div>

    <script>
      let allResults = [];
      let countdownTimer;
      let autoRefreshTimer;

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadResults();
        startAutoRefresh();
      });

      function loadResults() {
        console.log("Loading admin results...");

        // Show loading state
        document.getElementById("resultsContainer").innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <div>Loading results...</div>
          </div>
        `;

        fetch("/api/results", {
          method: "GET",
          headers: {
            "Cache-Control": "no-cache",
            "Content-Type": "application/json",
          },
        })
          .then((response) => {
            console.log("Response status:", response.status);
            if (!response.ok) {
              throw new Error(
                `HTTP ${response.status}: ${response.statusText}`
              );
            }
            return response.json();
          })
          .then((data) => {
            console.log("Received data:", data);
            allResults = Array.isArray(data) ? data : [];
            updateDashboardStats(allResults);
            displayResults(allResults);

            // Show last update time
            const now = new Date().toLocaleTimeString();
            console.log(`Results updated at ${now}`);
          })
          .catch((error) => {
            console.error("Error loading results:", error);
            document.getElementById("resultsContainer").innerHTML = `
            <div class="no-results">
              <div class="no-results-icon">‚ùå</div>
              <h3>Failed to load results</h3>
              <p>Error: ${error.message}</p>
              <button onclick="loadResults()" style="margin-top: 15px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                üîÑ Retry
              </button>
            </div>
          `;

            // Keep previous data if available
            if (allResults && allResults.length > 0) {
              console.log("Using cached results");
              updateDashboardStats(allResults);
              displayResults(allResults);
            }
          });
      }

      function updateDashboardStats(results) {
        const total = results.length;
        document.getElementById("totalSubmissions").textContent = total;

        if (total === 0) {
          document.getElementById("averageScore").textContent = "0%";
          document.getElementById("highestScore").textContent = "0%";
          document.getElementById("lowestScore").textContent = "0%";
          return;
        }

        // Calculate percentages with better error handling
        const validResults = results.filter(
          (r) =>
            r.totalScore !== undefined &&
            r.maxScore !== undefined &&
            r.maxScore > 0
        );

        if (validResults.length === 0) {
          document.getElementById("averageScore").textContent = "N/A";
          document.getElementById("highestScore").textContent = "N/A";
          document.getElementById("lowestScore").textContent = "N/A";
          return;
        }

        const percentages = validResults.map((r) => {
          const maxScore = r.maxScore || 100;
          return (r.totalScore / maxScore) * 100;
        });

        const average = (
          percentages.reduce((sum, p) => sum + p, 0) / percentages.length
        ).toFixed(1);
        const highest = Math.max(...percentages).toFixed(1);
        const lowest = Math.min(...percentages).toFixed(1);

        document.getElementById("averageScore").textContent = average + "%";
        document.getElementById("highestScore").textContent = highest + "%";
        document.getElementById("lowestScore").textContent = lowest + "%";
      }

      function displayResults(results) {
        const container = document.getElementById("resultsContainer");

        if (results.length === 0) {
          container.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üìù</div>
                        <h3>No submissions yet</h3>
                        <p>Waiting for students to submit their tests...</p>
                    </div>
                `;
          return;
        }

        let html = `
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Roll Number</th>
                            <th>Total Score</th>
                            <th>Percentage</th>
                            <th>Q1</th>
                            <th>Q2</th>
                            <th>Q3</th>
                            <th>Q4</th>
                            <th>MCQ Score</th>
                            <th>Submission Time</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        results.forEach((result, index) => {
          // Handle different data structures
          const totalScore = result.totalScore || 0;
          const maxScore = result.maxScore || 100;
          const rollNumber = result.name || "UNKNOWN1"; // name field now contains roll number
          const results_data = result.results || {};

          const percentage =
            maxScore > 0 ? ((totalScore / maxScore) * 100).toFixed(1) : "0.0";
          const scoreClass = getScoreClass(percentage);

          // Handle different timestamp formats
          let submissionTime = "Unknown";
          if (result.timestamp) {
            try {
              submissionTime = new Date(result.timestamp).toLocaleString();
            } catch (e) {
              submissionTime = result.timestamp;
            }
          }

          html += `
            <tr>
              <td class="student-roll">${rollNumber}</td>
              <td>${totalScore}/${maxScore}</td>
              <td>
                <span class="score-badge ${scoreClass}">${percentage}%</span>
              </td>
          `;

          // Question scores with better error handling
          for (let i = 1; i <= 4; i++) {
            const qResult = results_data[i];
            let score = 0;
            const maxQuestionScore = 25; // Default to 25 points per question

            if (qResult && typeof qResult.score === "number") {
              score = qResult.score;
            }

            const qClass =
              score === maxQuestionScore
                ? "score-full"
                : score > 0
                ? "score-partial"
                : "score-zero";

            html += `<td class="question-score ${qClass}">${score}/${maxQuestionScore}</td>`;
          }

          // MCQ score
          const mcqScore = result.mcqScore || 0;
          const mcqMaxScore = result.mcqMaxScore || 25;
          const mcqClass =
            mcqScore === mcqMaxScore
              ? "score-full"
              : mcqScore > 0
              ? "score-partial"
              : "score-zero";
          html += `<td class="question-score ${mcqClass}">${mcqScore}/${mcqMaxScore}</td>`;

          html += `
            <td class="submission-time">${submissionTime}</td>
            <td>
              <button class="detailed-view-btn" onclick="showDetails(${index})">
                üëÅÔ∏è View Details
              </button>
            </td>
          </tr>
          `;
        });

        html += "</tbody></table>";
        container.innerHTML = html;
      }

      function getScoreClass(percentage) {
        if (percentage >= 90) return "score-excellent";
        if (percentage >= 75) return "score-good";
        if (percentage >= 60) return "score-average";
        return "score-poor";
      }

      function sortResults() {
        const sortBy = document.getElementById("sortBy").value;
        let sorted = [...allResults];

        switch (sortBy) {
          case "score-desc":
            sorted.sort((a, b) => b.totalScore - a.totalScore);
            break;
          case "score-asc":
            sorted.sort((a, b) => a.totalScore - b.totalScore);
            break;
          case "name-asc":
            sorted.sort((a, b) => a.name.localeCompare(b.name));
            break;
          case "time-desc":
            sorted.sort(
              (a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0)
            );
            break;
        }

        displayResults(sorted);
      }

      function filterResults() {
        const filterBy = document.getElementById("filterBy").value;
        let filtered = allResults;

        if (filterBy !== "all") {
          filtered = allResults.filter((result) => {
            const percentage = (result.totalScore / result.maxScore) * 100;
            switch (filterBy) {
              case "excellent":
                return percentage >= 90;
              case "good":
                return percentage >= 75 && percentage < 90;
              case "average":
                return percentage >= 60 && percentage < 75;
              case "poor":
                return percentage < 60;
              default:
                return true;
            }
          });
        }

        displayResults(filtered);
      }

      function showDetails(index) {
        const result = allResults[index];
        const modal = document.getElementById("detailModal");
        const title = document.getElementById("modalTitle");
        const content = document.getElementById("modalContent");

        title.textContent = `${result.name} - Detailed Results`;

        let html = `
                <div style="margin-bottom: 20px;">
                    <h4>Overall Performance</h4>
                    <p><strong>Roll Number:</strong> ${result.name}</p>
                      result.rollNumber || "N/A"
                    }</p>
                    <p><strong>Total Score:</strong> ${result.totalScore}/${
          result.maxScore
        } (${((result.totalScore / result.maxScore) * 100).toFixed(1)}%)</p>
                    <div style="display: flex; gap: 20px; margin: 15px 0;">
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px;">
                            <strong>Coding Questions:</strong> ${
                              result.codingScore || 0
                            }/${result.codingMaxScore || 75}
                        </div>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px;">
                            <strong>MCQ Questions:</strong> ${
                              result.mcqScore || 0
                            }/${result.mcqMaxScore || 25}
                        </div>
                    </div>
                </div>
            `;

        // Display coding results
        if (result.results && Object.keys(result.results).length > 0) {
          html += `<h4 style="color: #2a5298; margin-bottom: 15px;">Coding Questions Results</h4>`;

          Object.keys(result.results).forEach((qNum) => {
            const qResult = result.results[qNum];
            html += `
                        <div style="margin-bottom: 25px; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                            <h5>Question ${qNum} Results</h5>
                    `;

            if (qResult.error) {
              html += `
                            <div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 10px; margin: 10px 0;">
                                <strong>Error:</strong> ${qResult.error}
                            </div>
                        `;
            } else {
              html += '<div style="margin: 15px 0;">';
              qResult.tests.forEach((test) => {
                html += `
                                <div style="margin: 8px 0; padding: 8px; background: ${
                                  test.passed ? "#f0f8f0" : "#fff0f0"
                                }; border-radius: 4px;">
                                    ${test.passed ? "‚úÖ" : "‚ùå"} Test ${
                  test.testCase
                }: 
                                    Expected ${test.expected}, Got ${
                  test.actual
                } 
                                    (${test.points}/10 points)
                                </div>
                            `;
              });
              html += "</div>";
            }

            // Show submitted code (if available)
            const submittedCode = getSubmittedCode(result.name, qNum);
            if (submittedCode) {
              html += `
                            <div style="margin-top: 15px;">
                                <h6>Submitted Code:</h6>
                                <div class="code-display">${submittedCode}</div>
                            </div>
                        `;
            }

            html += "</div>";
          });
        }

        // Display MCQ results
        if (result.mcqResults && Object.keys(result.mcqResults).length > 0) {
          html += `<h4 style="color: #2a5298; margin: 20px 0 15px 0;">Multiple Choice Questions Results</h4>`;

          Object.keys(result.mcqResults).forEach((mcqKey) => {
            const mcqResult = result.mcqResults[mcqKey];
            const questionNum = mcqKey.replace("mcq", "");
            const questionLabel = parseInt(questionNum) + 4; // MCQ starts from Q5

            html += `
                        <div style="margin: 10px 0; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; background: ${
                          mcqResult.status === "Correct" ? "#f0f8f0" : "#fff0f0"
                        };">
                            <div style="display: flex; justify-content: between; align-items: center;">
                                <span style="font-weight: bold;">
                                    ${
                                      mcqResult.status === "Correct"
                                        ? "‚úÖ"
                                        : "‚ùå"
                                    } Question ${questionLabel} (MCQ)
                                </span>
                                <span style="margin-left: auto; font-weight: bold;">
                                    ${mcqResult.score}/${
              mcqResult.maxScore
            } points
                                </span>
                            </div>
                            <div style="margin-top: 10px; font-size: 14px; color: #666;">
                                <div>Student Answer: <strong>${
                                  mcqResult.studentAnswer
                                }</strong></div>
                                <div>Correct Answer: <strong>${
                                  mcqResult.correctAnswer
                                }</strong></div>
                            </div>
                        </div>
                    `;
          });
        }

        content.innerHTML = html;
        modal.style.display = "block";
      }

      function getSubmittedCode(studentName, qNum) {
        // This would need to be passed from the server
        // For now, return placeholder
        return `// Code for Question ${qNum} would be displayed here
// This requires server-side implementation to store submitted code`;
      }

      function closeModal() {
        document.getElementById("detailModal").style.display = "none";
      }

      function exportResults() {
        if (allResults.length === 0) {
          alert("No results to export");
          return;
        }

        let csv =
          "Roll Number,Total Score,Max Score,Percentage,Q1 Score,Q2 Score,Q3 Score,Q4 Score,MCQ Score,MCQ Max,Submission Time\n";

        allResults.forEach((result) => {
          const percentage = (
            (result.totalScore / result.maxScore) *
            100
          ).toFixed(1);
          const submissionTime = new Date(
            result.timestamp || Date.now()
          ).toISOString();

          const scores = [];
          for (let i = 1; i <= 4; i++) {
            scores.push(result.results[i] ? result.results[i].score : 0);
          }

          const mcqScore = result.mcqScore || 0;
          const mcqMaxScore = result.mcqMaxScore || 25;
          const rollNumber = result.name; // name field now contains roll number

          csv += `"${rollNumber}",${result.totalScore},${
            result.maxScore
          },${percentage}%,${scores.join(
            ","
          )},${mcqScore},${mcqMaxScore},${submissionTime}\n`;
        });

        const blob = new Blob([csv], { type: "text/csv" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `coding_test_results_${
          new Date().toISOString().split("T")[0]
        }.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
      }

      function startAutoRefresh() {
        let countdown = 10;

        countdownTimer = setInterval(() => {
          countdown--;
          document.getElementById("countdown").textContent = countdown;

          if (countdown <= 0) {
            loadResults();
            countdown = 10;
          }
        }, 1000);
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("detailModal");
        if (event.target === modal) {
          closeModal();
        }
      };
    </script>
  </body>
</html>
